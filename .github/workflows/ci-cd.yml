name: CI-CD
on: [push]
jobs:
    build:
          runs-on: ubuntu-latest
              steps:
                      - uses: actions/checkout@v4
                            - name: Set up Node
                                    uses: actions/setup-node@v4
                                            with: node-version: '18'
                                                  - name: Run tests
                                                          run: npm ci && npm test
                                                                - name: Run SonarQube scan
                                                                        env:
                                                                                    SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
                                                                                            run: |
                                                                                                        npm run sonar
                                                                                                              - name: Build Docker image
                                                                                                                      run: |
                                                                                                                                  docker build -t ${{ secrets.REGISTRY }}/service-a:${{ github.sha }} .
                                                                                                                                        - name: Push image
                                                                                                                                                env:
                                                                                                                                                            REGISTRY_TOKEN: ${{ secrets.REGISTRY_TOKEN }}
                                                                                                                                                                    run: |
                                                                                                                                                                                echo $REGISTRY_TOKEN | docker login ${{ secrets.REGISTRY }} -u ${{ secrets.REGISTRY_USER }} --password-stdin
                                                                                                                                                                                          docker push ${{ secrets.REGISTRY }}/service-a:${{ github.sha }}

